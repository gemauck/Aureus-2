<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Debug - Abcotronics ERP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">System Debug Report</h1>
        
        <div id="debug-results" class="space-y-6">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Loading...</h2>
                <div class="animate-pulse">
                    <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Load utilities first -->
    <script type="text/babel" src="./src/utils/localStorage.js"></script>
    <script type="text/babel" src="./src/utils/api.js"></script>
    <script type="text/babel" src="./src/components/auth/AuthProvider.jsx"></script>
    <script type="text/babel" src="./src/components/theme/ThemeProvider.jsx"></script>

    <!-- Load components -->
    <script type="text/babel" src="./src/components/projects/Projects.jsx"></script>
    <script type="text/babel" src="./src/components/teams/Teams.jsx"></script>
    <script type="text/babel" src="./src/components/time/TimeTracking.jsx"></script>
    <script type="text/babel" src="./src/components/hr/HR.jsx"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const DebugReport = () => {
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const runDiagnostics = async () => {
                    const diagnostics = [];

                    // Check React availability
                    diagnostics.push({
                        category: 'React Framework',
                        tests: [
                            {
                                name: 'React Available',
                                status: typeof React !== 'undefined' ? 'pass' : 'fail',
                                details: typeof React !== 'undefined' ? `React ${React.version}` : 'React not loaded'
                            },
                            {
                                name: 'ReactDOM Available',
                                status: typeof ReactDOM !== 'undefined' ? 'pass' : 'fail',
                                details: typeof ReactDOM !== 'undefined' ? `ReactDOM ${ReactDOM.version}` : 'ReactDOM not loaded'
                            }
                        ]
                    });

                    // Check Storage
                    diagnostics.push({
                        category: 'Storage System',
                        tests: [
                            {
                                name: 'Storage Object',
                                status: typeof window.storage !== 'undefined' ? 'pass' : 'fail',
                                details: typeof window.storage !== 'undefined' ? 'Storage utilities loaded' : 'Storage not available'
                            },
                            {
                                name: 'getProjects Method',
                                status: typeof window.storage?.getProjects === 'function' ? 'pass' : 'fail',
                                details: typeof window.storage?.getProjects === 'function' ? 'Method available' : 'Method missing'
                            },
                            {
                                name: 'setProjects Method',
                                status: typeof window.storage?.setProjects === 'function' ? 'pass' : 'fail',
                                details: typeof window.storage?.setProjects === 'function' ? 'Method available' : 'Method missing'
                            }
                        ]
                    });

                    // Check API
                    diagnostics.push({
                        category: 'API System',
                        tests: [
                            {
                                name: 'API Object',
                                status: typeof window.api !== 'undefined' ? 'pass' : 'fail',
                                details: typeof window.api !== 'undefined' ? 'API utilities loaded' : 'API not available'
                            },
                            {
                                name: 'Login Method',
                                status: typeof window.api?.login === 'function' ? 'pass' : 'fail',
                                details: typeof window.api?.login === 'function' ? 'Method available' : 'Method missing'
                            }
                        ]
                    });

                    // Check Components
                    diagnostics.push({
                        category: 'Components',
                        tests: [
                            {
                                name: 'Projects Component',
                                status: typeof window.Projects !== 'undefined' ? 'pass' : 'fail',
                                details: typeof window.Projects !== 'undefined' ? 'Component loaded' : 'Component not loaded'
                            },
                            {
                                name: 'Teams Component',
                                status: typeof window.Teams !== 'undefined' ? 'pass' : 'fail',
                                details: typeof window.Teams !== 'undefined' ? 'Component loaded' : 'Component not loaded'
                            },
                            {
                                name: 'TimeTracking Component',
                                status: typeof window.TimeTracking !== 'undefined' ? 'pass' : 'fail',
                                details: typeof window.TimeTracking !== 'undefined' ? 'Component loaded' : 'Component not loaded'
                            },
                            {
                                name: 'HR Component',
                                status: typeof window.HR !== 'undefined' ? 'pass' : 'fail',
                                details: typeof window.HR !== 'undefined' ? 'Component loaded' : 'Component not loaded'
                            }
                        ]
                    });

                    // Check Auth System
                    diagnostics.push({
                        category: 'Authentication',
                        tests: [
                            {
                                name: 'AuthProvider',
                                status: typeof window.AuthProvider !== 'undefined' ? 'pass' : 'fail',
                                details: typeof window.AuthProvider !== 'undefined' ? 'AuthProvider loaded' : 'AuthProvider not loaded'
                            },
                            {
                                name: 'useAuth Hook',
                                status: typeof window.useAuth !== 'undefined' ? 'pass' : 'fail',
                                details: typeof window.useAuth !== 'undefined' ? 'useAuth hook available' : 'useAuth hook missing'
                            }
                        ]
                    });

                    // Check Theme System
                    diagnostics.push({
                        category: 'Theme System',
                        tests: [
                            {
                                name: 'ThemeProvider',
                                status: typeof window.ThemeProvider !== 'undefined' ? 'pass' : 'fail',
                                details: typeof window.ThemeProvider !== 'undefined' ? 'ThemeProvider loaded' : 'ThemeProvider not loaded'
                            },
                            {
                                name: 'useTheme Hook',
                                status: typeof window.useTheme !== 'undefined' ? 'pass' : 'fail',
                                details: typeof window.useTheme !== 'undefined' ? 'useTheme hook available' : 'useTheme hook missing'
                            }
                        ]
                    });

                    // Test Component Rendering
                    diagnostics.push({
                        category: 'Component Rendering Tests',
                        tests: []
                    });

                    // Try to render each component
                    const componentsToTest = [
                        { name: 'Projects', component: window.Projects },
                        { name: 'Teams', component: window.Teams },
                        { name: 'TimeTracking', component: window.TimeTracking },
                        { name: 'HR', component: window.HR }
                    ];

                    for (const comp of componentsToTest) {
                        try {
                            if (comp.component) {
                                // Try to create element
                                const element = React.createElement(comp.component);
                                diagnostics[diagnostics.length - 1].tests.push({
                                    name: `${comp.name} Rendering`,
                                    status: 'pass',
                                    details: 'Component can be instantiated'
                                });
                            } else {
                                diagnostics[diagnostics.length - 1].tests.push({
                                    name: `${comp.name} Rendering`,
                                    status: 'fail',
                                    details: 'Component not available'
                                });
                            }
                        } catch (error) {
                            diagnostics[diagnostics.length - 1].tests.push({
                                name: `${comp.name} Rendering`,
                                status: 'fail',
                                details: `Error: ${error.message}`
                            });
                        }
                    }

                    // Check for console errors
                    const originalError = console.error;
                    const errors = [];
                    console.error = (...args) => {
                        errors.push(args.join(' '));
                        originalError.apply(console, args);
                    };

                    // Restore console.error after a short delay
                    setTimeout(() => {
                        console.error = originalError;
                        if (errors.length > 0) {
                            diagnostics.push({
                                category: 'Console Errors',
                                tests: errors.map(error => ({
                                    name: 'Error',
                                    status: 'fail',
                                    details: error
                                }))
                            });
                        }
                    }, 1000);

                    setResults(diagnostics);
                    setLoading(false);
                };

                runDiagnostics();
            }, []);

            if (loading) {
                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <h2 className="text-xl font-semibold text-gray-800 mb-4">Running Diagnostics...</h2>
                        <div className="animate-pulse">
                            <div className="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                            <div className="h-4 bg-gray-200 rounded w-1/2"></div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="space-y-6">
                    {results.map((category, index) => (
                        <div key={index} className="bg-white rounded-lg shadow p-6">
                            <h2 className="text-xl font-semibold text-gray-800 mb-4">{category.category}</h2>
                            <div className="space-y-3">
                                {category.tests.map((test, testIndex) => (
                                    <div key={testIndex} className="flex items-center justify-between p-3 rounded-lg border">
                                        <div className="flex items-center space-x-3">
                                            <div className={`w-3 h-3 rounded-full ${
                                                test.status === 'pass' ? 'bg-green-500' : 'bg-red-500'
                                            }`}></div>
                                            <span className="font-medium text-gray-700">{test.name}</span>
                                        </div>
                                        <span className={`text-sm px-2 py-1 rounded ${
                                            test.status === 'pass' 
                                                ? 'bg-green-100 text-green-800' 
                                                : 'bg-red-100 text-red-800'
                                        }`}>
                                            {test.status}
                                        </span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        ReactDOM.render(<DebugReport />, document.getElementById('debug-results'));
    </script>
</body>
</html>
