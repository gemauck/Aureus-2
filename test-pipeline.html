<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipeline Platform - Test Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Pipeline Platform Test Suite</h1>
                    <p class="text-gray-600 mt-2">Verify all Pipeline features are working correctly</p>
                </div>
                <button 
                    onclick="runAllTests()"
                    class="px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 font-medium"
                >
                    <i class="fas fa-play mr-2"></i>
                    Run All Tests
                </button>
            </div>

            <div id="testResults" class="space-y-4">
                <!-- Test results will be inserted here -->
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-8">
            <h2 class="text-xl font-bold text-gray-900 mb-4">Manual Test Checklist</h2>
            <div class="space-y-3">
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Pipeline page loads without errors</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Metrics dashboard displays correctly</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">All four AIDA stages show in Kanban view</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Deal cards display with all information</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Drag and drop moves cards between stages</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Changes save to localStorage</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">List view displays all deals in table</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Forecast view shows monthly projections</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Search filter works correctly</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Value range filters work</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Probability filter works</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Industry filter works</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Age range filter works</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Sort options change order correctly</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Clear filters button works</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Refresh button reloads data</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">New Deal button navigates to CRM</span>
                </label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" class="w-5 h-5 text-primary-600">
                    <span class="text-sm text-gray-700">Clicking deal card opens details (when implemented)</span>
                </label>
            </div>
        </div>
    </div>

    <script>
        // Tailwind config
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        };

        const tests = [
            {
                name: 'Component Loaded',
                test: () => typeof window.Pipeline !== 'undefined',
                description: 'Verify Pipeline component is loaded'
            },
            {
                name: 'React Available',
                test: () => typeof React !== 'undefined',
                description: 'Verify React is loaded'
            },
            {
                name: 'Storage Utilities',
                test: () => typeof window.storage !== 'undefined',
                description: 'Verify localStorage utilities are available'
            },
            {
                name: 'Storage Has Leads',
                test: () => {
                    const storage = window.storage;
                    const leads = storage?.getLeads();
                    return Array.isArray(leads);
                },
                description: 'Verify leads can be retrieved from storage'
            },
            {
                name: 'Storage Has Clients',
                test: () => {
                    const storage = window.storage;
                    const clients = storage?.getClients();
                    return Array.isArray(clients);
                },
                description: 'Verify clients can be retrieved from storage'
            },
            {
                name: 'Integration Helper',
                test: () => typeof window.initializePipeline === 'function',
                description: 'Verify integration helper functions are loaded'
            },
            {
                name: 'Navigate Function',
                test: () => typeof window.navigateToPipeline === 'function',
                description: 'Verify navigation helper is available'
            }
        ];

        function runTest(test) {
            try {
                const result = test.test();
                return {
                    name: test.name,
                    description: test.description,
                    passed: result,
                    error: null
                };
            } catch (error) {
                return {
                    name: test.name,
                    description: test.description,
                    passed: false,
                    error: error.message
                };
            }
        }

        function renderTestResult(result) {
            const icon = result.passed 
                ? '<i class="fas fa-check-circle text-green-500 text-xl"></i>'
                : '<i class="fas fa-times-circle text-red-500 text-xl"></i>';
            
            const bgColor = result.passed ? 'bg-green-50' : 'bg-red-50';
            const borderColor = result.passed ? 'border-green-200' : 'border-red-200';
            
            return `
                <div class="flex items-start gap-4 p-4 ${bgColor} border ${borderColor} rounded-lg">
                    <div class="flex-shrink-0 mt-1">${icon}</div>
                    <div class="flex-1">
                        <h3 class="font-semibold text-gray-900">${result.name}</h3>
                        <p class="text-sm text-gray-600 mt-1">${result.description}</p>
                        ${result.error ? `<p class="text-sm text-red-600 mt-2"><strong>Error:</strong> ${result.error}</p>` : ''}
                    </div>
                </div>
            `;
        }

        function runAllTests() {
            const resultsContainer = document.getElementById('testResults');
            resultsContainer.innerHTML = '<div class="text-center py-8"><i class="fas fa-spinner fa-spin text-4xl text-primary-600"></i><p class="text-gray-600 mt-4">Running tests...</p></div>';
            
            setTimeout(() => {
                const results = tests.map(runTest);
                const passedCount = results.filter(r => r.passed).length;
                const failedCount = results.length - passedCount;
                
                let html = `
                    <div class="bg-gradient-to-r from-primary-50 to-blue-50 rounded-lg p-6 mb-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">Test Results</h3>
                                <p class="text-sm text-gray-600 mt-1">Completed ${results.length} tests</p>
                            </div>
                            <div class="flex gap-6">
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-green-600">${passedCount}</div>
                                    <div class="text-xs text-gray-600 mt-1">Passed</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-red-600">${failedCount}</div>
                                    <div class="text-xs text-gray-600 mt-1">Failed</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                html += results.map(renderTestResult).join('');
                resultsContainer.innerHTML = html;
                
                // Show recommendations if tests failed
                if (failedCount > 0) {
                    resultsContainer.innerHTML += `
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mt-6">
                            <h3 class="font-semibold text-gray-900 mb-3">
                                <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                                Troubleshooting Steps
                            </h3>
                            <ul class="space-y-2 text-sm text-gray-700">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-chevron-right text-yellow-600 mt-1"></i>
                                    <span>Verify Pipeline.jsx is loaded in index.html</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-chevron-right text-yellow-600 mt-1"></i>
                                    <span>Check browser console for errors</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-chevron-right text-yellow-600 mt-1"></i>
                                    <span>Ensure React and storage utilities are loaded before Pipeline</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-chevron-right text-yellow-600 mt-1"></i>
                                    <span>Check localStorage has some leads or clients data</span>
                                </li>
                            </ul>
                        </div>
                    `;
                }
            }, 500);
        }

        // Console helpers
        console.log('%c Pipeline Test Suite Loaded ', 'background: #2563eb; color: white; padding: 10px; font-size: 16px; font-weight: bold;');
        console.log('Available test commands:');
        console.log('  runAllTests() - Run all automated tests');
        console.log('  window.Pipeline - Access Pipeline component');
        console.log('  window.navigateToPipeline() - Navigate to Pipeline');
        console.log('  window.initializePipeline() - Initialize Pipeline');
    </script>
</body>
</html>
