<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipeline Diagnostic Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .test-result { font-family: monospace; }
        .pass { color: #059669; }
        .fail { color: #dc2626; }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">üîç Pipeline Diagnostic Tool</h1>
            <p class="text-gray-600 mb-6">This will help identify why Pipeline isn't showing</p>

            <div class="space-y-4">
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4">
                    <h3 class="font-bold text-blue-900 mb-2">
                        <i class="fas fa-lightbulb mr-2"></i>Quick Fix Steps
                    </h3>
                    <ol class="space-y-2 text-sm text-blue-800 ml-4">
                        <li><strong>1. Hard Refresh Browser:</strong> Press <code class="bg-blue-900 text-blue-100 px-2 py-1 rounded">Ctrl + Shift + R</code> (Windows) or <code class="bg-blue-900 text-blue-100 px-2 py-1 rounded">Cmd + Shift + R</code> (Mac)</li>
                        <li><strong>2. Clear Browser Cache:</strong> Or use Incognito/Private mode</li>
                        <li><strong>3. Restart Server:</strong> Stop and restart <code class="bg-blue-900 text-blue-100 px-2 py-1 rounded">python3 server.py</code></li>
                    </ol>
                </div>

                <button 
                    onclick="runDiagnostics()" 
                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition"
                >
                    <i class="fas fa-play mr-2"></i>
                    Run Diagnostics
                </button>

                <div id="results" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <script>
        async function runDiagnostics() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="text-center py-4"><i class="fas fa-spinner fa-spin text-4xl text-blue-600"></i></div>';

            await new Promise(resolve => setTimeout(resolve, 500));

            const tests = [];
            
            // Test 1: Check if server is running
            tests.push({
                name: 'Server Status',
                test: async () => {
                    try {
                        const response = await fetch('http://localhost:8000/');
                        return response.ok;
                    } catch (e) {
                        return false;
                    }
                },
                fix: 'Start server: cd to project folder, run: python3 server.py'
            });

            // Test 2: Check if Pipeline.jsx file exists
            tests.push({
                name: 'Pipeline.jsx File',
                test: async () => {
                    try {
                        const response = await fetch('./src/components/clients/Pipeline.jsx');
                        return response.ok;
                    } catch (e) {
                        return false;
                    }
                },
                fix: 'File missing. Re-create Pipeline.jsx in src/components/clients/'
            });

            // Test 3: Check if React is loaded
            tests.push({
                name: 'React Library',
                test: () => typeof React !== 'undefined',
                fix: 'Check internet connection, React loads from CDN'
            });

            // Test 4: Check if window.Pipeline exists (requires main app)
            tests.push({
                name: 'Pipeline Component Loaded',
                test: () => typeof window.Pipeline !== 'undefined',
                fix: 'Open main app (localhost:8000), then run this test'
            });

            // Test 5: Check if window.storage exists
            tests.push({
                name: 'Storage Utilities',
                test: () => typeof window.storage !== 'undefined',
                fix: 'Open main app (localhost:8000), then run this test'
            });

            // Run all tests
            const results = [];
            for (const test of tests) {
                const passed = typeof test.test === 'function' && await test.test();
                results.push({
                    name: test.name,
                    passed,
                    fix: test.fix
                });
            }

            // Display results
            let html = '<div class="bg-white rounded-lg border border-gray-200 overflow-hidden">';
            html += '<div class="bg-gray-50 px-4 py-3 border-b border-gray-200"><h3 class="font-bold text-gray-900">Diagnostic Results</h3></div>';
            html += '<div class="divide-y divide-gray-200">';

            results.forEach(result => {
                const icon = result.passed ? 'fa-check-circle' : 'fa-times-circle';
                const color = result.passed ? 'text-green-600' : 'text-red-600';
                const bgColor = result.passed ? 'bg-green-50' : 'bg-red-50';
                
                html += `
                    <div class="p-4 ${bgColor}">
                        <div class="flex items-start gap-3">
                            <i class="fas ${icon} ${color} text-xl mt-0.5"></i>
                            <div class="flex-1">
                                <div class="font-bold text-gray-900">${result.name}</div>
                                <div class="text-sm ${result.passed ? 'text-green-700' : 'text-red-700'} mt-1">
                                    ${result.passed ? '‚úì Passed' : '‚úó Failed'}
                                </div>
                                ${!result.passed ? `<div class="text-xs text-gray-600 mt-2"><strong>Fix:</strong> ${result.fix}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });

            html += '</div></div>';

            const passCount = results.filter(r => r.passed).length;
            const totalCount = results.length;

            if (passCount === totalCount) {
                html += `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mt-4">
                        <div class="flex items-center gap-2 text-green-800">
                            <i class="fas fa-check-circle text-2xl"></i>
                            <div>
                                <div class="font-bold">All Tests Passed!</div>
                                <div class="text-sm">Pipeline should be visible. Try hard refresh: Ctrl+Shift+R</div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                html += `
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-4">
                        <div class="flex items-center gap-2 text-yellow-800">
                            <i class="fas fa-exclamation-triangle text-2xl"></i>
                            <div>
                                <div class="font-bold">${passCount}/${totalCount} Tests Passed</div>
                                <div class="text-sm">Follow the fix instructions above for failed tests</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Add manual verification steps
            html += `
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mt-4">
                    <h3 class="font-bold text-gray-900 mb-3">Manual Verification Steps:</h3>
                    <ol class="space-y-2 text-sm text-gray-700 list-decimal ml-5">
                        <li>Open <code class="bg-gray-200 px-2 py-1 rounded">http://localhost:8000</code></li>
                        <li>Press <code class="bg-gray-200 px-2 py-1 rounded">F12</code> to open DevTools</li>
                        <li>Go to Console tab</li>
                        <li>Type: <code class="bg-gray-200 px-2 py-1 rounded">console.log(window.Pipeline)</code></li>
                        <li>If it shows "undefined", Pipeline isn't loading</li>
                        <li>If it shows "function", Pipeline loaded but menu issue</li>
                    </ol>
                </div>

                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mt-4">
                    <h3 class="font-bold text-purple-900 mb-3">Still Not Working? Try This:</h3>
                    <div class="space-y-2 text-sm text-purple-800">
                        <div><strong>Option 1:</strong> Clear all browser data for localhost</div>
                        <div><strong>Option 2:</strong> Try a different browser</div>
                        <div><strong>Option 3:</strong> Open in Incognito/Private mode</div>
                        <div><strong>Option 4:</strong> Check browser console for red error messages</div>
                    </div>
                </div>
            `;

            resultsDiv.innerHTML = html;
        }

        // Run diagnostics on load
        window.addEventListener('load', () => {
            console.log('%c Pipeline Diagnostic Tool Loaded ', 'background: #3b82f6; color: white; padding: 10px; font-size: 14px; font-weight: bold;');
            console.log('Click "Run Diagnostics" button to test');
        });
    </script>
</body>
</html>
