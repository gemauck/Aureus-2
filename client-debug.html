<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Debug - Abco ERP</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 12px 24px; margin: 8px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
        input { padding: 10px; margin: 8px; width: 250px; border: 1px solid #ddd; border-radius: 4px; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>üîç Client Debug - Abco ERP</h1>
    
    <div class="section">
        <h3>Test Client Creation</h3>
        <input type="text" id="clientName" placeholder="Client Name" value="Test Client">
        <input type="email" id="clientEmail" placeholder="Email" value="test@example.com">
        <input type="text" id="clientIndustry" placeholder="Industry" value="Technology">
        
        <button onclick="testCreateClient()">Create Client</button>
        <button onclick="testLoadClients()">Load Clients</button>
        <button onclick="clearStorage()">Clear Storage</button>
        
        <div id="results"></div>
    </div>

    <div class="section">
        <h3>Storage Debug</h3>
        <button onclick="checkStorage()">Check localStorage</button>
        <div id="storage-info"></div>
    </div>

    <script>
        const RAILWAY_URL = 'https://abco-erp-2-production.up.railway.app';
        
        // Mock the storage functions
        const mockStorage = {
            getClients: () => {
                try {
                    const clients = localStorage.getItem('abcotronics_clients');
                    return clients ? JSON.parse(clients) : null;
                } catch (e) {
                    console.error('Error loading clients:', e);
                    return null;
                }
            },
            
            setClients: (clients) => {
                localStorage.setItem('abcotronics_clients', JSON.stringify(clients));
                console.log('‚úÖ Clients saved to localStorage:', clients.length);
            },
            
            getToken: () => {
                return localStorage.getItem('abcotronics_token');
            }
        };
        
        // Mock the API
        const mockAPI = {
            createClient: async (clientData) => {
                console.log('üöÄ API createClient called with:', clientData);
                
                try {
                    const response = await fetch(`${RAILWAY_URL}/api/clients`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(clientData)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    console.log('üì° API createClient response:', data);
                    return data;
                } catch (error) {
                    console.error('‚ùå API createClient error:', error);
                    throw error;
                }
            },
            
            listClients: async () => {
                console.log('üöÄ API listClients called');
                
                try {
                    const response = await fetch(`${RAILWAY_URL}/api/clients`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    console.log('üì° API listClients response:', data);
                    return data;
                } catch (error) {
                    console.error('‚ùå API listClients error:', error);
                    throw error;
                }
            }
        };
        
        async function testCreateClient() {
            const resultsDiv = document.getElementById('results');
            const name = document.getElementById('clientName').value;
            const email = document.getElementById('clientEmail').value;
            const industry = document.getElementById('clientIndustry').value;
            
            resultsDiv.innerHTML = '<p>Creating client...</p>';
            
            try {
                const clientData = {
                    name: name,
                    email: email,
                    industry: industry,
                    status: 'Active',
                    type: 'client'
                };
                
                console.log('üìù Creating client with data:', clientData);
                
                // Try API first
                try {
                    const apiResult = await mockAPI.createClient(clientData);
                    resultsDiv.innerHTML = `
                        <div class="section success">
                            <h4>‚úÖ Client Created via API</h4>
                            <pre>${JSON.stringify(apiResult, null, 2)}</pre>
                        </div>
                    `;
                } catch (apiError) {
                    console.log('API failed, falling back to localStorage');
                    
                    // Fallback to localStorage
                    const existingClients = mockStorage.getClients() || [];
                    const newClient = {
                        id: Date.now().toString(),
                        ...clientData,
                        createdAt: new Date().toISOString()
                    };
                    
                    const updatedClients = [...existingClients, newClient];
                    mockStorage.setClients(updatedClients);
                    
                    resultsDiv.innerHTML = `
                        <div class="section success">
                            <h4>‚úÖ Client Created via localStorage</h4>
                            <pre>${JSON.stringify(newClient, null, 2)}</pre>
                            <p>Total clients: ${updatedClients.length}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="section error">
                        <h4>‚ùå Error Creating Client</h4>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        async function testLoadClients() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Loading clients...</p>';
            
            try {
                // Try API first
                try {
                    const apiResult = await mockAPI.listClients();
                    resultsDiv.innerHTML = `
                        <div class="section success">
                            <h4>‚úÖ Clients Loaded via API</h4>
                            <pre>${JSON.stringify(apiResult, null, 2)}</pre>
                        </div>
                    `;
                } catch (apiError) {
                    console.log('API failed, checking localStorage');
                    
                    // Fallback to localStorage
                    const clients = mockStorage.getClients();
                    
                    if (clients && clients.length > 0) {
                        resultsDiv.innerHTML = `
                            <div class="section success">
                                <h4>‚úÖ Clients Loaded via localStorage</h4>
                                <pre>${JSON.stringify(clients, null, 2)}</pre>
                                <p>Total clients: ${clients.length}</p>
                            </div>
                        `;
                    } else {
                        resultsDiv.innerHTML = `
                            <div class="section error">
                                <h4>‚ùå No Clients Found</h4>
                                <p>No clients in API or localStorage</p>
                            </div>
                        `;
                    }
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="section error">
                        <h4>‚ùå Error Loading Clients</h4>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function checkStorage() {
            const storageDiv = document.getElementById('storage-info');
            
            const clients = mockStorage.getClients();
            const token = mockStorage.getToken();
            
            storageDiv.innerHTML = `
                <pre>Token: ${token ? 'Present' : 'None'}
Clients: ${clients ? clients.length : 0}
Storage Keys: ${Object.keys(localStorage).join(', ')}</pre>
            `;
        }
        
        function clearStorage() {
            localStorage.clear();
            document.getElementById('results').innerHTML = '<p>Storage cleared!</p>';
            checkStorage();
        }
        
        // Auto-check storage on load
        window.onload = function() {
            checkStorage();
        };
    </script>
</body>
</html>
