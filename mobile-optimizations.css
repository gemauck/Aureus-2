/* Enhanced Mobile-First Responsive Design for Abco ERP */

/* Base mobile styles */
@media (max-width: 768px) {
  /* Login page isolation: prevent global sticky/fixed overlays from covering the form */
  body.login-page header,
  body.login-page .header-mobile,
  body.login-page [class*="header"],
  body.login-page .mobile-nav,
  body.login-page [class*="mobile-header"],
  body.login-page [class*="page-header"],
  body.login-page div[class*="sticky"],
  body.login-page div[class*="border-b"],
  body.login-page [class*="filter-bar"],
  body.login-page [class*="toolbar"],
  body.login-page [class*="action-bar"],
  body.login-page [class*="tabs"],
  body.login-page .nav-tabs {
    position: static !important;
    top: auto !important;
    z-index: auto !important;
    background: transparent !important;
    box-shadow: none !important;
    border: 0 !important;
    display: none !important;
  }

  /* On login, keep dropdowns/menus positioned relative to their containers */
  body.login-page .relative > div[class*="absolute"],
  body.login-page div[class*="dropdown"],
  body.login-page div[class*="menu"]:not(nav):not([class*="nav"]) {
    position: absolute !important;
    width: auto !important;
    left: auto !important;
    right: auto !important;
    transform: none !important;
    box-shadow: none !important;
    background: transparent !important;
    display: none !important;
  }
  
  /* Login page specific mobile fixes */
  body.login-page {
    position: relative !important;
    height: 100vh !important;
    height: 100dvh !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }
  
  body.login-page #root {
    min-height: 100vh !important;
    min-height: 100dvh !important;
    height: 100vh !important;
    height: 100dvh !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: stretch !important;
    justify-content: flex-start !important;
    background: linear-gradient(to bottom right, #3b82f6, #1e40af) !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }
  
  body.login-page .login-outer {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    flex: 1 !important;
    min-height: 100vh !important;
    min-height: 100dvh !important;
  }
  
  /* Ensure login form container is visible and properly sized */
  body.login-page .login-container {
    width: calc(100% - 2rem) !important;
    max-width: 420px !important;
    margin: 1rem auto !important;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    z-index: 10 !important;
  }
  
  /* Login form inputs must be touch-friendly */
  body.login-page input,
  body.login-page textarea,
  body.login-page select {
    font-size: 16px !important;
    min-height: 48px !important;
    padding: 14px 16px !important;
    width: 100% !important;
    -webkit-appearance: none !important;
    appearance: none !important;
    border: 2px solid #e5e7eb !important;
    border-radius: 12px !important;
    background: white !important;
  }
  
  body.login-page input:focus,
  body.login-page textarea:focus,
  body.login-page select:focus {
    border-color: #3b82f6 !important;
    outline: none !important;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
  }
  
  /* Login button styling */
  body.login-page button[type="submit"] {
    min-height: 48px !important;
    font-size: 16px !important;
    padding: 14px 18px !important;
    width: 100% !important;
    touch-action: manipulation !important;
  }
  
  /* Ensure labels are visible */
  body.login-page label {
    font-size: 14px !important;
    margin-bottom: 8px !important;
    display: block !important;
    font-weight: 600 !important;
  }

  /* Global mobile optimizations - excluding login page */
  body:not(.login-page) * {
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
  }
  
  /* Allow text selection for inputs and textareas */
  input, textarea, [contenteditable] {
    -webkit-user-select: text !important;
    user-select: text !important;
  }
  
  /* Ensure login page is fully interactive */
  body.login-page * {
    -webkit-user-select: text !important;
    user-select: text !important;
    pointer-events: auto !important;
  }
  
  body.login-page input,
  body.login-page button,
  body.login-page textarea,
  body.login-page select {
    touch-action: manipulation !important;
    -webkit-tap-highlight-color: rgba(59, 130, 246, 0.2) !important;
  }
  
  body {
    font-size: 16px;
    line-height: 1.5;
    -webkit-text-size-adjust: 100%;
    touch-action: manipulation;
  }
  
  /* Container adjustments */
  .container, .max-w-7xl, .max-w-6xl {
    padding-left: 0.75rem;
    padding-right: 0.75rem;
  }
  
  /* Typography scaling */
  h1 { font-size: 1.5rem; }
  h2 { font-size: 1.25rem; }
  h3 { font-size: 1.125rem; }
  h4 { font-size: 1rem; }
  
  /* Enhanced button optimizations for touch */
  button, .btn {
    min-height: 48px;
    min-width: 48px;
    padding: 14px 18px;
    font-size: 16px;
    border-radius: 12px;
    touch-action: manipulation;
    transition: all 0.2s ease;
    position: relative;
    overflow: hidden;
  }
  
  /* Active state for better touch feedback */
  button:active, .btn:active {
    transform: scale(0.98);
    transition: transform 0.1s ease;
  }
  
  /* Primary button enhancements */
  .bg-primary-600 {
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
  }
  
  .bg-primary-600:active {
    box-shadow: 0 1px 4px rgba(59, 130, 246, 0.4);
  }
  
  /* Enhanced form inputs - OVERRIDE ALL FORM ELEMENTS */
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  input[type="tel"],
  input[type="date"],
  input[type="time"],
  input[type="datetime-local"],
  input[type="search"],
  textarea,
  select {
    min-height: 48px !important;
    padding: 14px 18px !important;
    font-size: 16px !important; /* Prevents zoom on iOS */
    border-radius: 12px;
    border: 2px solid #e5e7eb !important;
    transition: all 0.2s ease;
    width: 100% !important;
    box-sizing: border-box;
    -webkit-appearance: none;
    appearance: none;
    background-color: white;
  }
  
  /* Special handling for textareas */
  textarea {
    min-height: 120px !important;
    resize: vertical;
    font-family: inherit;
  }
  
  /* Select dropdown styling */
  select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23374151' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 18px center;
    background-size: 12px;
    padding-right: 48px !important;
  }
  
  input:focus, textarea:focus, select:focus {
    outline: none !important;
    border-color: #3b82f6 !important;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
  }
  
  /* Fix for date/time inputs on iOS */
  input[type="date"],
  input[type="time"],
  input[type="datetime-local"] {
    position: relative;
  }
  
  input[type="date"]::-webkit-calendar-picker-indicator,
  input[type="time"]::-webkit-calendar-picker-indicator,
  input[type="datetime-local"]::-webkit-calendar-picker-indicator {
    position: absolute;
    right: 18px;
    width: 24px;
    height: 24px;
    opacity: 1;
    cursor: pointer;
  }
  
  /* Label improvements */
  label {
    display: block !important;
    margin-bottom: 10px !important;
    font-weight: 600;
    font-size: 15px !important;
    color: #374151;
    line-height: 1.4;
  }
  
  /* Form group spacing */
  .form-group,
  div[class*="space-y"] > div,
  form > div {
    margin-bottom: 20px !important;
  }
  
  /* Grid form fixes - stack on mobile */
  .grid.grid-cols-2,
  .grid.grid-cols-3,
  .grid.grid-cols-4 {
    grid-template-columns: 1fr !important;
    gap: 16px !important;
  }
  
  /* Override specific small text sizes in forms */
  input.text-xs,
  select.text-xs,
  textarea.text-xs {
    font-size: 16px !important;
    padding: 14px 18px !important;
  }
  
  input.text-sm,
  select.text-sm,
  textarea.text-sm {
    font-size: 16px !important;
    padding: 14px 18px !important;
  }
  
  /* Override small padding */
  input[class*="py-1"],
  input[class*="py-1.5"],
  input[class*="py-2"] {
    padding-top: 14px !important;
    padding-bottom: 14px !important;
  }
  
  select[class*="py-1"],
  select[class*="py-1.5"],
  select[class*="py-2"] {
    padding-top: 14px !important;
    padding-bottom: 14px !important;
  }
  
  textarea[class*="py-1"],
  textarea[class*="py-1.5"],
  textarea[class*="py-2"] {
    padding-top: 14px !important;
    padding-bottom: 14px !important;
  }
  
  /* Enhanced card styles */
  .mobile-card {
    background: white;
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 12px;
    border: 1px solid #e5e7eb;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }
  
  .mobile-card:active {
    transform: scale(0.98);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  }
  
  .mobile-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #3b82f6, #1d4ed8);
    opacity: 0;
    transition: opacity 0.2s ease;
  }
  
  .mobile-card:hover::before {
    opacity: 1;
  }
  
  /* Tables - convert to cards on mobile */
  .table-responsive {
    display: none;
  }
  
  /* Mobile navigation enhancements - ENSURE ALL NAVIGATION IS STICKY */
  .mobile-nav,
  [class*="mobile-header"],
  [class*="page-header"],
  div[class*="sticky"][class*="top-0"] {
    position: sticky !important;
    position: -webkit-sticky !important;
    top: 56px !important; /* Below main header */
    z-index: 40 !important;
    background: white !important;
    border-bottom: 1px solid #e5e7eb !important;
    padding: 12px 16px !important;
  }
  
  .dark .mobile-nav,
  .dark [class*="mobile-header"],
  .dark [class*="page-header"] {
    background: #1f2937 !important;
    border-bottom-color: #374151 !important;
  }
  
  /* Legacy mobile-nav class */
  .mobile-nav {
    top: 56px;
    z-index: 40;
  }
  
  /* Modern browser :has() support for headers with h1/h2 and buttons */
  @supports selector(:has(*)) {
    div[class*="border-b"]:has(h1):has(button):not(header):not([role="dialog"]),
    div[class*="border-b"]:has(h2):has(button):not(header):not([role="dialog"]) {
      position: sticky !important;
      position: -webkit-sticky !important;
      top: 56px !important;
      z-index: 40 !important;
      background: white !important;
      border-bottom: 1px solid #e5e7eb !important;
      padding: 12px 16px !important;
    }
    
    .dark div[class*="border-b"]:has(h1):has(button),
    .dark div[class*="border-b"]:has(h2):has(button) {
      background: #1f2937 !important;
      border-bottom-color: #374151 !important;
    }
  }
  
  .mobile-nav-tabs {
    display: flex;
    background: #f3f4f6;
    border-radius: 12px;
    padding: 4px;
  }
  
  .mobile-nav-tab {
    flex: 1;
    padding: 12px 16px;
    text-align: center;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.2s ease;
    color: #6b7280;
  }
  
  .mobile-nav-tab.active {
    background: white;
    color: #3b82f6;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  
  /* Mobile search enhancements */
  .mobile-search {
    position: relative;
    margin: 16px;
  }
  
  .mobile-search input {
    padding-left: 48px;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
  }
  
  .mobile-search .search-icon {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: #9ca3af;
    font-size: 18px;
  }
  
  /* Mobile filters */
  .mobile-filters {
    background: #f9fafb;
    border-radius: 12px;
    padding: 16px;
    margin: 16px;
    border: 1px solid #e5e7eb;
  }
  
  .mobile-filter-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  
  /* Mobile status badges */
  .mobile-status-badge {
    display: inline-flex;
    align-items: center;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .status-active {
    background: #dcfce7;
    color: #166534;
  }
  
  .status-new {
    background: #fef3c7;
    color: #92400e;
  }
  
  .status-qualified {
    background: #dbeafe;
    color: #1e40af;
  }
  
  .status-closed-won {
    background: #dcfce7;
    color: #166534;
  }
  
  .status-inactive {
    background: #f3f4f6;
    color: #6b7280;
  }
  
  /* Mobile loading states */
  .mobile-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 48px 16px;
  }
  
  .mobile-loading .spinner {
    width: 32px;
    height: 32px;
    border: 3px solid #e5e7eb;
    border-top: 3px solid #3b82f6;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  /* Mobile empty states */
  .mobile-empty-state {
    text-align: center;
    padding: 48px 16px;
  }
  
  .mobile-empty-state .icon {
    font-size: 48px;
    color: #d1d5db;
    margin-bottom: 16px;
  }
  
  .mobile-empty-state h3 {
    font-size: 18px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
  }
  
  .mobile-empty-state p {
    font-size: 14px;
    color: #6b7280;
    margin-bottom: 24px;
  }
  
  .table-mobile {
    display: block;
  }
  
  .table-mobile .mobile-card {
    background: white;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border: 1px solid #e5e7eb;
  }
  
  /* Sidebar optimizations */
  .sidebar-mobile {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    width: 280px;
    z-index: 1000;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
  }
  
  .sidebar-mobile.open {
    transform: translateX(0);
  }
  
  /* Ensure hamburger menu button is always visible on mobile */
  @media (max-width: 1023px) {
    header.header-mobile button[aria-label="Toggle menu"],
    header.header-mobile button:has(.fa-bars),
    header .fa-bars {
      display: flex !important;
      visibility: visible !important;
      opacity: 1 !important;
      pointer-events: auto !important;
      z-index: 1001 !important;
    }
    
    /* Ensure hamburger button is large enough for touch */
    header.header-mobile button[aria-label="Toggle menu"] {
      min-width: 44px !important;
      min-height: 44px !important;
      padding: 8px !important;
    }
  }
  
  @media (min-width: 1024px) {
    header.header-mobile button[aria-label="Toggle menu"] {
      display: none !important;
    }
  }
  
  /* Ensure sidebar text is visible on mobile */
  .sidebar-mobile.open nav button span,
  .sidebar-mobile.open nav button,
  .sidebar-mobile.open * {
    color: inherit !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* Ensure text in sidebar menu items is visible */
  @media (max-width: 768px) {
    .sidebar-mobile.open nav button {
      width: 100% !important;
      overflow: visible !important;
      white-space: nowrap !important;
    }
    
    .sidebar-mobile.open nav button span {
      display: inline-block !important;
      visibility: visible !important;
      opacity: 1 !important;
      color: inherit !important;
    }
    
    /* Dark mode text visibility */
    .dark .sidebar-mobile.open nav button {
      color: #e5e7eb !important;
    }
    
    .dark .sidebar-mobile.open nav button span {
      color: #e5e7eb !important;
    }
    
    .dark .sidebar-mobile.open nav button.active span,
    .dark .sidebar-mobile.open nav button:hover span {
      color: #ffffff !important;
    }
  }
  
  .sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.5);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }
  
  .sidebar-overlay.open {
    opacity: 1;
    visibility: visible;
  }
  
  /* Sidebar scroll improvements */
  nav.overflow-y-auto,
  .sidebar-scrollbar,
  aside[class*="overflow"] {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    overscroll-behavior: contain;
  }
  
  /* Menu button touch targets */
  nav button,
  nav a,
  .menu-item {
    min-height: 56px !important;
    padding: 16px !important;
    font-size: 16px !important;
    display: flex !important;
    align-items: center;
    gap: 12px;
    width: 100%;
    text-align: left;
  }
  
  /* Header optimizations - FIXED ON MOBILE */
  header,
  .header-mobile,
  [class*="header"] {
    position: sticky !important;
    position: -webkit-sticky !important;
    top: 0 !important;
    z-index: 50 !important;
    background: white !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
  }
  
  .dark header,
  .dark .header-mobile,
  .dark [class*="header"] {
    background: #1f2937 !important;
  }
  
  .header-mobile {
    height: 56px;
    padding: 0 16px;
  }
  
  .header-mobile .search-input {
    display: none;
  }
  
  /* Ensure main content has padding-top to account for fixed header */
  main,
  .main-content,
  [class*="main-content"] {
    padding-top: 0 !important;
  }
  
  /* Add safe area for fixed header */
  body {
    padding-top: 0;
  }
  
  /* Main content area should scroll under fixed header */
  .flex-1.overflow-auto {
    position: relative;
  }
  
  /* Modal optimizations */
  .modal,
  [class*="modal"],
  [role="dialog"] {
    margin: 0 !important;
    max-height: 100vh !important;
    border-radius: 0 !important;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    z-index: 1000;
  }
  
  .modal-dialog,
  [class*="modal-dialog"] {
    margin: 0 !important;
    max-width: 100% !important;
    height: 100vh !important;
    display: flex !important;
    flex-direction: column !important;
  }
  
  .modal-content,
  [class*="modal-content"] {
    flex: 1 !important;
    border-radius: 0 !important;
    border: none !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
    display: flex !important;
    flex-direction: column !important;
    max-height: 100vh !important;
  }
  
  .modal-header,
  [class*="modal-header"] {
    padding: 20px 16px !important;
    border-bottom: 1px solid #e5e7eb;
    position: sticky !important;
    top: 0 !important;
    background: white;
    z-index: 10;
    flex-shrink: 0;
  }
  
  .modal-body,
  [class*="modal-body"],
  form {
    padding: 20px 16px !important;
    flex: 1;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
  
  .modal-footer,
  [class*="modal-footer"] {
    padding: 20px 16px !important;
    border-top: 1px solid #e5e7eb;
    position: sticky !important;
    bottom: 0 !important;
    background: white;
    z-index: 10;
    flex-shrink: 0;
    display: flex;
    gap: 12px;
  }
  
  /* Modal form button improvements */
  .modal-footer button,
  [class*="modal-footer"] button,
  form button[type="submit"] {
    flex: 1;
    min-height: 52px !important;
    font-size: 16px !important;
    font-weight: 600;
  }
  
  /* Ensure modals are scrollable */
  [class*="fixed"][class*="inset"] {
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
  }
  
  /* Dropdown menus - fix positioning on mobile */
  .relative > div[class*="absolute"]:not([class*="tooltip"]),
  div[class*="dropdown"]:not([class*="tooltip"]),
  div[class*="menu"]:not(nav):not([class*="nav"]) {
    position: fixed !important;
    max-height: 60vh !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
    z-index: 2000;
    width: calc(100vw - 32px) !important;
    left: 16px !important;
    right: 16px !important;
    transform: none !important;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2) !important;
    border-radius: 12px !important;
    background: white !important;
  }
  
  /* Prevent dropdown from going off screen */
  div[class*="absolute"][style*="top"] {
    max-height: calc(100vh - 120px) !important;
  }
  
  /* Select dropdown options */
  select option {
    padding: 14px 18px !important;
    font-size: 16px !important;
    min-height: 48px;
  }
  
  /* Form optimizations - already covered above but keep for specificity */
  .form-group {
    margin-bottom: 24px !important;
  }
  
  .form-label {
    display: block !important;
    margin-bottom: 10px !important;
    font-weight: 600;
    font-size: 15px !important;
  }
  
  .form-control {
    width: 100% !important;
    min-height: 48px !important;
    padding: 14px 18px !important;
    border: 2px solid #d1d5db !important;
    border-radius: 12px;
    font-size: 16px !important;
    background: white;
  }
  
  .form-control:focus {
    outline: none !important;
    border-color: #3b82f6 !important;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
  }
  
  /* Scrollable areas in forms */
  [class*="overflow-y-auto"],
  [class*="overflow-auto"],
  div[style*="overflow"] {
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  
  /* Better scrollbars for mobile */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  
  ::-webkit-scrollbar-track {
    background: #f1f1f1;
  }
  
  ::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: #555;
  }
  
  /* Grid system for mobile */
  .grid-mobile {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
  }
  
  .grid-mobile-2 {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
  }
  
  /* Force single column on mobile for FORM grids only */
  form .grid[class*="grid-cols-2"],
  form .grid[class*="grid-cols-3"],
  form .grid[class*="grid-cols-4"],
  .modal .grid[class*="grid-cols-2"],
  .modal .grid[class*="grid-cols-3"],
  .modal .grid[class*="grid-cols-4"],
  [class*="modal"] .grid[class*="grid-cols-2"],
  [class*="modal"] .grid[class*="grid-cols-3"],
  [class*="modal"] .grid[class*="grid-cols-4"] {
    grid-template-columns: 1fr !important;
    gap: 16px !important;
  }
  
  /* Exception: Keep 2 columns for stats and dashboard cards */
  .grid[class*="stats"],
  .grid[class*="summary"],
  .grid[class*="dashboard"] {
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 12px !important;
  }
  
  /* Card optimizations */
  .card {
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border: 1px solid #e5e7eb;
    overflow: hidden;
  }
  
  .card-header {
    padding: 16px;
    border-bottom: 1px solid #e5e7eb;
    background: #f9fafb;
  }
  
  .card-body {
    padding: 16px;
  }
  
  /* Navigation tabs - STICKY ON MOBILE */
  .nav-tabs,
  [class*="nav-tabs"],
  [class*="tabs"],
  .overflow-x-auto[class*="tab"] {
    display: flex !important;
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch !important;
    border-bottom: 1px solid #e5e7eb !important;
    padding: 0 16px !important;
    position: sticky !important;
    position: -webkit-sticky !important;
    top: 56px !important; /* Below main header */
    z-index: 40 !important;
    background: white !important;
    margin: 0 !important;
  }
  
  .dark .nav-tabs,
  .dark [class*="nav-tabs"],
  .dark [class*="tabs"] {
    background: #1f2937 !important;
    border-bottom-color: #374151 !important;
  }
  
  /* Use :has() for modern browsers only */
  @supports selector(:has(*)) {
    div[class*="tab"]:has(button) {
      display: flex !important;
      overflow-x: auto !important;
      position: sticky !important;
      position: -webkit-sticky !important;
      top: 56px !important;
      z-index: 40 !important;
      background: white !important;
    }
    
    .dark div[class*="tab"]:has(button) {
      background: #1f2937 !important;
    }
  }
  
  .nav-tab {
    flex: 0 0 auto;
    padding: 12px 16px;
    border-bottom: 2px solid transparent;
    white-space: nowrap;
    font-size: 14px;
    color: #6b7280;
    text-decoration: none;
    min-height: 48px;
    display: flex;
    align-items: center;
  }
  
  .nav-tab.active {
    color: #3b82f6;
    border-bottom-color: #3b82f6;
  }
  
  /* Page-level navigation bars and filter bars */
  [class*="filter-bar"],
  [class*="toolbar"],
  [class*="action-bar"],
  div[class*="filter"]:not(select):not(input) {
    position: sticky !important;
    position: -webkit-sticky !important;
    top: 56px !important;
    z-index: 40 !important;
    background: white !important;
  }
  
  .dark [class*="filter-bar"],
  .dark [class*="toolbar"],
  .dark [class*="action-bar"],
  .dark div[class*="filter"]:not(select):not(input) {
    background: #1f2937 !important;
  }
  
  /* If there are tabs above, adjust positioning */
  .nav-tabs ~ [class*="filter-bar"],
  .nav-tabs ~ [class*="toolbar"],
  [class*="tabs"] ~ div[class*="filter"]:not(select):not(input) {
    top: 112px !important; /* Header + tabs (56px header + ~56px tabs) */
  }
  
  /* Use :has() for modern browsers only */
  @supports selector(:has(*)) {
    div[class*="border-b"]:has(button):not(header):not([role="dialog"]):not([class*="modal"]),
    div[class*="border-b"]:has(input[type="search"]):not(header),
    div[class*="border-b"]:has(input[type="text"]):not(header) {
      position: sticky !important;
      position: -webkit-sticky !important;
      top: 56px !important;
      z-index: 40 !important;
      background: white !important;
    }
    
    .dark div[class*="border-b"]:has(button):not(header) {
      background: #1f2937 !important;
    }
  }
  
  /* Statistics cards */
  .stat-card {
    text-align: center;
    padding: 20px 16px;
    border-radius: 12px;
    background: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border: 1px solid #e5e7eb;
  }
  
  .stat-value {
    font-size: 24px;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 4px;
  }
  
  .stat-label {
    font-size: 12px;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  /* Pipeline board mobile */
  .pipeline-mobile {
    display: block;
  }
  
  .pipeline-stage {
    margin-bottom: 20px;
    background: #f9fafb;
    border-radius: 12px;
    padding: 16px;
  }
  
  .pipeline-stage-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid #e5e7eb;
  }
  
  .pipeline-stage-title {
    font-weight: 600;
    font-size: 14px;
    color: #1f2937;
  }
  
  .pipeline-stage-count {
    background: #e5e7eb;
    color: #374151;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
  }
  
  .pipeline-item {
    background: white;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border: 1px solid #e5e7eb;
  }
  
  /* Action buttons */
  .action-buttons {
    display: flex;
    gap: 8px;
    margin-top: 12px;
  }
  
  .action-btn {
    flex: 1;
    padding: 10px 16px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    text-align: center;
    text-decoration: none;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .action-btn-primary {
    background: #3b82f6;
    color: white;
  }
  
  .action-btn-secondary {
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #d1d5db;
  }
  
  /* Floating action button */
  .fab {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: #3b82f6;
    color: white;
    border: none;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    z-index: 100;
  }
  
  /* Loading states */
  .loading-skeleton {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: 8px;
  }
  
  @keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }
  
  /* Touch-friendly interactions */
  .touch-target,
  button,
  a.button,
  [role="button"] {
    min-height: 48px !important;
    min-width: 48px !important;
    padding: 14px 18px !important;
    font-size: 16px !important;
  }
  
  /* Small action buttons (icons only) */
  button[class*="p-1"],
  button[class*="p-1.5"],
  button[class*="p-2"] {
    min-height: 44px !important;
    min-width: 44px !important;
  }
  
  /* Swipe gestures */
  .swipe-container {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  
  .swipe-container::-webkit-scrollbar {
    display: none;
  }
  
  /* Pull-to-refresh indicator */
  .pull-to-refresh {
    position: absolute;
    top: -60px;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #3b82f6;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: top 0.3s ease;
  }
  
  .pull-to-refresh.active {
    top: 20px;
  }
  
  /* Additional scrollable menu fixes */
  [class*="sidebar"] nav,
  aside nav,
  [class*="menu-list"],
  [class*="nav-menu"] {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
    scrollbar-width: thin;
  }
  
  /* Prevent horizontal scroll on forms */
  form,
  .modal-body,
  [class*="modal-body"] {
    overflow-x: hidden !important;
    word-wrap: break-word;
  }
  
  /* Better spacing in tight forms */
  form > * + * {
    margin-top: 20px !important;
  }
  
  /* Fix for select dropdowns that might be cut off */
  select {
    max-width: 100% !important;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  /* Ensure checkboxes and radios are touch-friendly */
  input[type="checkbox"],
  input[type="radio"] {
    width: 24px !important;
    height: 24px !important;
    min-width: 24px !important;
    min-height: 24px !important;
    margin-right: 12px;
    cursor: pointer;
  }
  
  label:has(input[type="checkbox"]),
  label:has(input[type="radio"]) {
    display: flex !important;
    align-items: center;
    cursor: pointer;
    padding: 12px 0;
  }
  
  /* Fix for very small screens */
  @media (max-width: 375px) {
    input, textarea, select {
      padding: 12px 16px !important;
      font-size: 16px !important;
    }
    
    label {
      font-size: 14px !important;
    }
    
    button {
      padding: 12px 16px !important;
      font-size: 15px !important;
    }
  }
  
  /* Prevent zoom on input focus for iOS (already at 16px but ensure it) */
  @supports (-webkit-touch-callout: none) {
    input, textarea, select {
      font-size: 16px !important;
    }
  }
  
  /* Ensure all component headers with sticky classes work correctly */
  div[class*="sticky"][class*="top"],
  [class*="sticky-top"],
  div.sticky.top-0,
  div.sticky.top-16 {
    position: -webkit-sticky !important;
    position: sticky !important;
  }
  
  /* Component-level page headers (like in Clients, Projects, etc.) */
  /* Use specific class patterns first, then fallback to :has() for modern browsers */
  div[class*="border-b"][class*="flex"]:not(header):not([role="dialog"]):not([class*="modal"]) {
    position: sticky !important;
    position: -webkit-sticky !important;
    top: 56px !important; /* Below main header */
    z-index: 40 !important;
    background: white !important;
  }
  
  .dark div[class*="border-b"][class*="flex"]:not(header):not([role="dialog"]) {
    background: #1f2937 !important;
  }
  
  /* Fallback for modern browsers with :has() support */
  @supports selector(:has(*)) {
    div:has(> h1):has(button):not(header):not(.modal):not([class*="modal"]),
    div:has(> h2):has(button):not(header):not(.modal):not([class*="modal"]) {
      position: sticky !important;
      position: -webkit-sticky !important;
      top: 56px !important;
      z-index: 40 !important;
      background: white !important;
    }
    
    .dark div:has(> h1):has(button),
    .dark div:has(> h2):has(button) {
      background: #1f2937 !important;
    }
  }
  
  /* Ensure responsive visibility - hide desktop-only elements */
  [class*="hidden"]:not([class*="md:block"]):not([class*="lg:block"]) {
    display: none !important;
  }
  
  /* Show mobile-only elements */
  [class*="mobile"]:not([class*="hidden"]) {
    display: block !important;
  }
  
  /* ============================================
     COMPREHENSIVE TABLE TO CARD CONVERSION
     ============================================ */
  
  /* Hide standard tables on mobile ONLY when cards are present */
  /* This prevents hiding tables before the converter runs */
  .mobile-table-cards ~ table {
    display: none !important;
  }
  
  /* Hide tables that have been converted (have data-mobile-converted) */
  table[data-mobile-converted="true"] {
    display: none !important;
  }
  
  /* Show tables that are explicitly marked to keep visible (small tables in modals) */
  table[data-keep-visible="true"] {
    display: table !important;
    width: 100% !important;
    font-size: 14px !important;
  }
  
  /* For tables without cards yet, show them (converter will handle) */
  /* But make them more mobile-friendly */
  table:not([data-mobile-converted="true"]):not([data-keep-visible="true"]) {
    display: table !important;
    width: 100% !important;
    font-size: 13px !important;
    border-collapse: collapse !important;
  }
  
  table:not([data-mobile-converted="true"]):not([data-keep-visible="true"]) th,
  table:not([data-mobile-converted="true"]):not([data-keep-visible="true"]) td {
    padding: 10px 8px !important;
    font-size: 13px !important;
    word-break: break-word !important;
  }
  
  /* Show table wrapper for card conversion */
  div:has(table) {
    position: relative;
  }
  
  /* Auto-generate card views for tables */
  table + .mobile-table-cards,
  .table-wrapper .mobile-table-cards {
    display: block !important;
  }
  
  /* Table container adjustments */
  div[class*="overflow"]:has(table),
  div:has(> table) {
    overflow-x: visible !important;
    overflow-y: visible !important;
  }
  
  /* Card-based table row representation */
  .mobile-table-card {
    background: white;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    border: 1px solid #e5e7eb;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    display: block !important;
    position: relative;
    transition: all 0.2s ease;
  }
  
  .mobile-table-card:active {
    transform: scale(0.98);
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.12);
  }
  
  .mobile-table-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
    padding-bottom: 12px;
    border-bottom: 2px solid #f3f4f6;
  }
  
  .mobile-table-card-title {
    font-weight: 600;
    font-size: 16px;
    color: #1f2937;
    flex: 1;
  }
  
  .mobile-table-card-badge {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    white-space: nowrap;
    margin-left: 8px;
  }
  
  .mobile-table-card-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 10px 0;
    border-bottom: 1px solid #f3f4f6;
  }
  
  .mobile-table-card-row:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }
  
  .mobile-table-card-label {
    font-size: 13px;
    font-weight: 500;
    color: #6b7280;
    min-width: 100px;
    flex-shrink: 0;
  }
  
  .mobile-table-card-value {
    font-size: 14px;
    font-weight: 500;
    color: #1f2937;
    text-align: right;
    flex: 1;
    word-break: break-word;
  }
  
  .mobile-table-card-actions {
    display: flex;
    gap: 8px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #f3f4f6;
  }
  
  .mobile-table-card-actions button {
    flex: 1;
    min-height: 44px;
    padding: 10px 16px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    border: 1px solid #e5e7eb;
    background: white;
    color: #374151;
    transition: all 0.2s ease;
  }
  
  .mobile-table-card-actions button:active {
    background: #f3f4f6;
    transform: scale(0.97);
  }
  
  .mobile-table-card-actions button.primary {
    background: #3b82f6;
    color: white;
    border-color: #3b82f6;
  }
  
  .mobile-table-card-actions button.primary:active {
    background: #2563eb;
  }
  
  /* Dark mode card styles */
  .dark .mobile-table-card {
    background: #1f2937;
    border-color: #374151;
  }
  
  .dark .mobile-table-card-header {
    border-bottom-color: #374151;
  }
  
  .dark .mobile-table-card-title {
    color: #f9fafb;
  }
  
  .dark .mobile-table-card-row {
    border-bottom-color: #374151;
  }
  
  .dark .mobile-table-card-label {
    color: #9ca3af;
  }
  
  .dark .mobile-table-card-value {
    color: #f9fafb;
  }
  
  .dark .mobile-table-card-actions {
    border-top-color: #374151;
  }
  
  .dark .mobile-table-card-actions button {
    background: #374151;
    border-color: #4b5563;
    color: #f9fafb;
  }
  
  .dark .mobile-table-card-actions button:active {
    background: #4b5563;
  }
  
  /* ============================================
     ENHANCED FORM IMPROVEMENTS
     ============================================ */
  
  /* Force minimum sizes for ALL form elements - ULTRA AGGRESSIVE */
  form input[type="text"],
  form input[type="email"],
  form input[type="password"],
  form input[type="number"],
  form input[type="tel"],
  form input[type="date"],
  form input[type="time"],
  form input[type="datetime-local"],
  form input[type="search"],
  form input[type="url"],
  form textarea,
  form select,
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  input[type="tel"],
  input[type="date"],
  input[type="time"],
  input[type="datetime-local"],
  input[type="search"],
  textarea,
  select {
    min-height: 52px !important;
    padding: 16px 18px !important;
    font-size: 16px !important;
    border-radius: 12px !important;
    border: 2px solid #e5e7eb !important;
    width: 100% !important;
    box-sizing: border-box !important;
  }
  
  /* Override ANY text size classes in forms */
  form input.text-xs,
  form input.text-sm,
  form select.text-xs,
  form select.text-sm,
  form textarea.text-xs,
  form textarea.text-sm {
    font-size: 16px !important;
    padding: 16px 18px !important;
  }
  
  /* Override ANY padding classes in forms */
  form input[class*="py-1"],
  form input[class*="py-1.5"],
  form input[class*="py-2"],
  form select[class*="py-1"],
  form select[class*="py-1.5"],
  form select[class*="py-2"],
  form textarea[class*="py-1"],
  form textarea[class*="py-1.5"],
  form textarea[class*="py-2"] {
    padding-top: 16px !important;
    padding-bottom: 16px !important;
  }
  
  /* Labels should be larger and more prominent - OVERRIDE ALL LABEL SIZES */
  form label,
  form .label,
  label {
    font-size: 15px !important;
    font-weight: 600 !important;
    color: #374151 !important;
    margin-bottom: 8px !important;
    display: block !important;
    line-height: 1.5 !important;
  }
  
  /* Override text-xs and text-sm on labels in forms */
  form label.text-xs,
  form label.text-sm,
  label.text-xs,
  label.text-sm {
    font-size: 15px !important;
  }
  
  /* Labels with text inside should also be readable */
  form label span,
  label span {
    font-size: 14px !important;
  }
  
  /* Override tiny text in label spans */
  form label span.text-xs,
  label span.text-xs {
    font-size: 14px !important;
  }
  
  /* Form groups need better spacing */
  form > div,
  form .space-y > *,
  form [class*="space-y"] > * {
    margin-bottom: 20px !important;
  }
  
  /* Checkboxes and radios - MUCH larger - OVERRIDE ALL SIZES */
  form input[type="checkbox"],
  form input[type="radio"],
  input[type="checkbox"],
  input[type="radio"] {
    width: 28px !important;
    height: 28px !important;
    min-width: 28px !important;
    min-height: 28px !important;
    margin-right: 12px !important;
    cursor: pointer !important;
    flex-shrink: 0 !important;
  }
  
  /* Override small checkbox/radio sizes (w-3, w-3.5, w-4, h-3, h-3.5, h-4) */
  form input[type="checkbox"][class*="w-3"],
  form input[type="checkbox"][class*="h-3"],
  form input[type="radio"][class*="w-3"],
  form input[type="radio"][class*="h-3"],
  input[type="checkbox"][class*="w-3"],
  input[type="checkbox"][class*="h-3"],
  input[type="radio"][class*="w-3"],
  input[type="radio"][class*="h-3"] {
    width: 28px !important;
    height: 28px !important;
    min-width: 28px !important;
    min-height: 28px !important;
  }
  
  /* Labels with checkboxes/radios */
  form label:has(input[type="checkbox"]),
  form label:has(input[type="radio"]),
  label:has(+ input[type="checkbox"]),
  label:has(+ input[type="radio"]) {
    display: flex !important;
    align-items: center !important;
    padding: 12px 0 !important;
    cursor: pointer !important;
    min-height: 52px !important;
  }
  
  /* Select dropdowns - better styling */
  form select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 12 12'%3E%3Cpath fill='%23374151' d='M6 9L1 4h10z'/%3E%3C/svg%3E") !important;
    background-repeat: no-repeat !important;
    background-position: right 18px center !important;
    background-size: 14px !important;
    padding-right: 50px !important;
    appearance: none !important;
    -webkit-appearance: none !important;
  }
  
  /* Focus states for all inputs */
  form input:focus,
  form textarea:focus,
  form select:focus {
    outline: none !important;
    border-color: #3b82f6 !important;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1) !important;
  }
  
  /* ============================================
     BOX/CARD IMPROVEMENTS
     ============================================ */
  
  /* All boxes/cards need better mobile spacing */
  .bg-white.rounded-lg,
  [class*="rounded-lg"].bg-white,
  .card,
  [class*="card"] {
    padding: 20px !important;
    margin-bottom: 16px !important;
    border-radius: 16px !important;
    border: 1px solid #e5e7eb !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06) !important;
  }
  
  /* Box headers */
  .card-header,
  [class*="border-b"]:has(h1, h2, h3, h4, h5, h6) {
    padding: 16px 20px !important;
    margin-bottom: 16px !important;
  }
  
  /* Box content */
  .card-body,
  [class*="card-body"] {
    padding: 0 20px 20px 20px !important;
  }
  
  /* Better spacing inside boxes */
  .bg-white.rounded-lg > *,
  .card > * {
    margin-bottom: 16px !important;
  }
  
  .bg-white.rounded-lg > *:last-child,
  .card > *:last-child {
    margin-bottom: 0 !important;
  }
  
  /* Dark mode boxes */
  .dark .bg-white.rounded-lg,
  .dark .card {
    background: #1f2937 !important;
    border-color: #374151 !important;
  }
  
  /* ============================================
     TABLE WRAPPER IMPROVEMENTS
     ============================================ */
  
  /* Containers that hold tables */
  div:has(table),
  .overflow-x-auto:has(table),
  .overflow-auto:has(table) {
    overflow-x: visible !important;
    padding: 0 !important;
    margin: 0 !important;
  }
  
  /* Ensure cards and containers adapt */
  [class*="container"],
  [class*="max-w"] {
    width: 100% !important;
    max-width: 100% !important;
    padding-left: 1rem !important;
    padding-right: 1rem !important;
  }
  
  /* Force no horizontal scroll */
  body,
  html {
    overflow-x: hidden !important;
    max-width: 100vw !important;
  }
}

/* Tablet styles */
@media (min-width: 769px) and (max-width: 1024px) {
  .container {
    padding-left: 1rem;
    padding-right: 1rem;
  }
  
  .grid-tablet {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }
  
  .grid-tablet-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
  }
}

/* Desktop styles - Reset sticky positioning */
@media (min-width: 1025px) {
  .table-responsive {
    display: block;
  }
  
  .table-mobile {
    display: none;
  }
  
  .pipeline-mobile {
    display: none;
  }
  
  .pipeline-desktop {
    display: block;
  }
  
  /* Remove sticky on desktop for main header (using static instead) */
  header.header-mobile,
  .header-mobile {
    position: static !important;
    top: auto !important;
    z-index: auto !important;
    box-shadow: none !important;
  }
  
  /* Navigation tabs can be sticky on desktop if needed, but adjust positioning */
  .nav-tabs,
  [class*="nav-tabs"],
  [class*="tabs"] {
    position: relative !important;
    top: auto !important;
  }
}

/* Dark mode mobile optimizations (respect explicit .dark class only) */
@media (max-width: 768px) {
  .dark .card {
    background: #1f2937;
    border-color: #374151;
  }
  
  .dark .modal-content {
    background: #1f2937;
    color: #f9fafb;
  }
  
  .dark .modal-header {
    background: #1f2937;
    border-color: #374151;
  }
  
  .dark .modal-footer {
    background: #1f2937;
    border-color: #374151;
  }
  
  .dark .form-control {
    background: #374151;
    border-color: #4b5563;
    color: #f9fafb;
  }
  
  .dark .form-control:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
  
  .dark .pipeline-stage {
    background: #374151;
  }
  
  .dark .pipeline-item {
    background: #1f2937;
    border-color: #374151;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .card {
    border: 2px solid;
  }
  
  .button {
    border: 2px solid;
  }
  
  .form-control {
    border: 2px solid;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Print styles */
@media print {
  .sidebar, .header, .fab, .modal {
    display: none !important;
  }
  
  .main-content {
    margin: 0 !important;
    padding: 0 !important;
  }
  
  .card {
    box-shadow: none !important;
    border: 1px solid #000 !important;
  }
}
