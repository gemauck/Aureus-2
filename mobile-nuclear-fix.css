/* =================================================================
   NUCLEAR OPTION - FORCE EVERYTHING VISIBLE BELOW 766PX
   This is the most aggressive fix possible
   ================================================================= */

/* Target EXACTLY the problem breakpoint */
@media (max-width: 766px) {
  /* FORCE ROOT AND BODY TO PROPER STATE */
  html, body {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    overflow-x: hidden !important;
    overflow-y: auto !important;
    width: 100vw !important;
    max-width: 100vw !important;
    min-width: 320px !important;
    height: auto !important;
    min-height: 100vh !important;
  }
  
  /* FORCE #ROOT TO DISPLAY */
  #root {
    display: flex !important;
    flex-direction: row !important;
    visibility: visible !important;
    opacity: 1 !important;
    width: 100vw !important;
    max-width: 100vw !important;
    height: 100vh !important;
    overflow: hidden !important;
    position: relative !important;
  }
  
  /* FORCE ALL CHILDREN OF ROOT TO BE VISIBLE */
  #root > * {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    flex-shrink: 0 !important;
  }
  
  /* FORCE FLEX LAYOUT CONTAINER TO WORK */
  .flex.h-screen,
  div[class*="flex"][class*="h-screen"] {
    display: flex !important;
    flex-direction: row !important;
    width: 100vw !important;
    max-width: 100vw !important;
    height: 100vh !important;
    overflow: hidden !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* FORCE SIDEBAR TO NOT BREAK LAYOUT */
  aside,
  [class*="sidebar"],
  nav[class*="sidebar"] {
    position: fixed !important;
    top: 0 !important;
    left: -100% !important;  /* Start off-screen */
    width: 280px !important;
    max-width: 85vw !important;
    height: 100vh !important;
    z-index: 100 !important;
    transition: left 0.3s ease !important;
    flex-shrink: 0 !important;
    overflow-y: auto !important;
    display: flex !important;
    flex-direction: column !important;
  }
  
  /* When sidebar is open */
  aside:not([style*="display: none"]),
  aside[style*="display: flex"] {
    left: 0 !important;
  }
  
  /* FORCE MAIN CONTENT TO BE VISIBLE AND TAKE FULL WIDTH */
  main,
  .flex-1,
  [class*="flex-1"],
  div[class*="flex-1"][class*="overflow"] {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    width: 100vw !important;
    max-width: 100vw !important;
    min-width: 100vw !important;
    flex: 1 1 auto !important;
    overflow-x: hidden !important;
    overflow-y: auto !important;
    height: calc(100vh - 56px) !important;
    margin: 0 !important;
    padding: 12px !important;
    position: relative !important;
  }
  
  /* FORCE ALL CONTENT INSIDE MAIN TO BE VISIBLE */
  main > *,
  main > div,
  main > div > * {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    width: 100% !important;
    max-width: 100% !important;
  }
  
  /* FORCE HEADER TO BE VISIBLE */
  header,
  .header-mobile,
  [class*="header"] {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: sticky !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    width: 100vw !important;
    max-width: 100vw !important;
    height: 56px !important;
    z-index: 50 !important;
    flex-shrink: 0 !important;
    background: white !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  }
  
  .dark header {
    background: #1f2937 !important;
  }
  
  /* FORCE HEADER CONTENTS TO BE VISIBLE */
  header * {
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* FORCE HAMBURGER BUTTON TO BE VISIBLE AND FUNCTIONAL */
  header button[aria-label*="menu"],
  header button[aria-label*="Menu"],
  header button:has(.fa-bars),
  .hamburger-menu-btn {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: relative !important;
    min-width: 44px !important;
    min-height: 44px !important;
    z-index: 51 !important;
  }
  
  /* REMOVE ANY TRANSFORMS THAT MIGHT HIDE CONTENT */
  main,
  main > *,
  [class*="content"] {
    transform: none !important;
  }
  
  /* EXCEPTION: Only sidebar can have transform */
  aside {
    /* transform handled above */
  }
  
  /* FORCE NO DISPLAY NONE EXCEPT ON SIDEBAR WHEN CLOSED */
  * {
    display: revert !important;
  }
  
  /* CRITICAL: Force main to display AFTER revert rule - Multiple selectors for maximum specificity */
  main,
  main[class],
  main[style],
  body main,
  #root main,
  #root > div > main,
  #root > div.flex main,
  div.flex-1 main,
  [class*="flex-1"] main,
  main.flex-1,
  main.overflow-y-auto,
  main.overflow-x-hidden {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* ULTRA-SPECIFIC: Override any inline styles or other CSS */
  main[style*="display"],
  main[style*="none"] {
    display: block !important;
  }
  
  aside[style*="display: none"] {
    display: flex !important;
    left: -100% !important;
  }
  
  /* FORCE VISIBILITY ON EVERYTHING */
  *, *::before, *::after {
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* EXCEPTION: Actually hidden elements */
  [hidden],
  .hidden {
    display: none !important;
  }
  
  /* FORCE PAGE CONTENT TO DISPLAY */
  [class*="page"],
  [class*="Page"],
  [class*="users"],
  [class*="Users"],
  [class*="dashboard"],
  [class*="Dashboard"] {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    width: 100% !important;
    max-width: 100% !important;
  }
  
  /* FORCE ALL CONTAINERS TO BE VISIBLE */
  .container,
  [class*="container"],
  [class*="Container"] {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    width: 100% !important;
    max-width: 100% !important;
  }
  
  /* FORCE CARDS TO BE VISIBLE */
  .card,
  [class*="card"],
  [class*="Card"],
  .bg-white {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    width: 100% !important;
    max-width: 100% !important;
  }
  
  /* FORCE BUTTONS TO BE VISIBLE */
  button {
    display: inline-flex !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* FORCE TEXT TO BE VISIBLE */
  h1, h2, h3, h4, h5, h6, p, span, div, a, label {
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* FORCE FORMS TO BE VISIBLE */
  form,
  input,
  select,
  textarea {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    width: 100% !important;
    max-width: 100% !important;
  }
  
  button {
    display: inline-flex !important;
  }
  
  /* FORCE NO MIN-WIDTH THAT BREAKS LAYOUT */
  * {
    min-width: 0 !important;
  }
  
  /* EXCEPTION: Touch targets need minimum */
  button,
  input,
  select,
  textarea {
    min-width: 44px !important;
    min-height: 44px !important;
  }
  
  /* FORCE NO OVERFLOW HIDDEN ON MAIN CONTAINERS */
  body,
  #root,
  .flex.h-screen {
    overflow-x: hidden !important;
    overflow-y: visible !important;
  }
  
  main {
    overflow-x: hidden !important;
    overflow-y: auto !important;
  }
  
  /* FORCE PROPER Z-INDEX STACKING */
  header {
    z-index: 50 !important;
  }
  
  aside {
    z-index: 100 !important;
  }
  
  main {
    z-index: 1 !important;
  }
  
  /* REMOVE ANY NEGATIVE MARGINS */
  * {
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
  
  /* REMOVE ANY ABSOLUTE POSITIONING THAT BREAKS LAYOUT */
  main *:not([class*="dropdown"]):not([class*="menu"]):not([class*="tooltip"]) {
    position: relative !important;
  }
  
  /* FORCE FLEX ITEMS TO NOT SHRINK TO ZERO */
  .flex > * {
    flex-shrink: 1 !important;
    min-width: 0 !important;
    min-height: 0 !important;
  }
  
  /* FORCE MAIN CONTENT AREA TO TAKE FULL WIDTH WHEN SIDEBAR IS HIDDEN */
  body:not(:has(aside:not([style*="display: none"]))) main,
  body:has(aside[style*="display: none"]) main {
    width: 100vw !important;
    margin-left: 0 !important;
  }
  
  /* DEBUG: Add a visible border to main to confirm it's showing */
  main {
    outline: 2px solid lime !important;
    outline-offset: -2px !important;
  }
  
  /* FORCE USER PAGE SPECIFIC ELEMENTS */
  [class*="user"],
  [class*="User"] {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* FORCE TABLE TO SHOW (OR ITS REPLACEMENT) */
  table,
  .mobile-card,
  [class*="mobile-card"] {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  table {
    width: 100% !important;
    max-width: 100% !important;
  }
  
  /* FORCE NO WIDTH CONSTRAINTS */
  [style*="width"] {
    width: auto !important;
    max-width: 100% !important;
  }
  
  /* FORCE PROPER BOX SIZING */
  *,
  *::before,
  *::after {
    box-sizing: border-box !important;
  }
}

/* EVEN MORE AGGRESSIVE FIX FOR 765px AND BELOW */
@media (max-width: 765px) {
  /* NUCLEAR RESET - FORCE EVERYTHING */
  * {
    max-width: 100vw !important;
    box-sizing: border-box !important;
  }
  
  /* FORCE ABSOLUTE VISIBILITY */
  body,
  body *:not([hidden]):not(.hidden) {
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* ENSURE FLEX DOESN'T BREAK */
  .flex {
    display: flex !important;
  }
  
  /* ENSURE GRID DOESN'T BREAK */
  .grid {
    display: grid !important;
    grid-template-columns: 1fr !important;
  }
  
  /* ENSURE BLOCK ELEMENTS DISPLAY */
  div, section, article, main, header, footer, nav {
    display: block !important;
  }
  
  /* OVERRIDE display: flex on main if it's causing issues */
  main {
    display: block !important;
  }
}

/* FAILSAFE FOR 750px - Another critical point */
@media (max-width: 750px) {
  /* If nothing else worked, this is the nuclear option */
  body {
    display: block !important;
    width: 100vw !important;
  }
  
  #root {
    display: block !important;
    width: 100vw !important;
  }
  
  #root > * {
    display: block !important;
    width: 100% !important;
  }
  
  header {
    display: block !important;
    width: 100% !important;
  }
  
  aside {
    display: none !important;
  }
  
  main {
    display: block !important;
    width: 100vw !important;
    padding: 12px !important;
  }
  
  main * {
    display: block !important;
    width: 100% !important;
    max-width: 100% !important;
  }
}

/* DEBUG BANNER REMOVED FOR PRODUCTION */
/* Uncomment below for debugging only */
/*
@media (max-width: 766px) {
  body::before {
    content: "NUCLEAR FIX ACTIVE - Width " attr(data-width) "px" !important;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    background: #ff0 !important;
    color: #000 !important;
    padding: 4px !important;
    text-align: center !important;
    z-index: 999999 !important;
    font-size: 12px !important;
    font-weight: bold !important;
  }
}
*/
