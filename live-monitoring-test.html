<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Monitoring Test - Railway Deployment - Abco ERP</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; padding: 20px; background: #f5f5f5; }
        .monitor-section { margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { background-color: #d4edda; border-left: 4px solid #28a745; }
        .error { background-color: #f8d7da; border-left: 4px solid #dc3545; }
        .warning { background-color: #fff3cd; border-left: 4px solid #ffc107; }
        .info { background-color: #d1ecf1; border-left: 4px solid #17a2b8; }
        .live { background-color: #e8f5e8; border-left: 4px solid #28a745; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        button { padding: 12px 24px; margin: 8px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-warning { background: #ffc107; color: #000; }
        .btn-info { background: #17a2b8; color: white; }
        button:hover { opacity: 0.8; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-online { background: #28a745; }
        .status-offline { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0; }
        .metric-card { background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .metric-value { font-size: 32px; font-weight: bold; color: #007bff; margin: 10px 0; }
        .metric-label { color: #666; font-size: 14px; }
        .log-container { background: #000; color: #00ff00; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; max-height: 400px; overflow-y: auto; }
        .log-entry { margin: 2px 0; }
        .log-error { color: #ff4444; }
        .log-success { color: #44ff44; }
        .log-warning { color: #ffaa44; }
        .log-info { color: #4444ff; }
        .progress-bar { width: 100%; height: 20px; background: #e0e0e0; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #007bff, #28a745); transition: width 0.3s; }
        .test-results { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .result-card { background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #007bff; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 11px; }
        .alert { padding: 15px; margin: 15px 0; border-radius: 4px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <h1>üîÑ Live Monitoring Test - Railway Deployment</h1>
    
    <div class="monitor-section live">
        <h3>üì° Real-time Deployment Status</h3>
        <div class="metric-grid">
            <div class="metric-card">
                <div class="metric-value" id="deployment-status">üîç</div>
                <div class="metric-label">Deployment Status</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="response-time">0ms</div>
                <div class="metric-label">Response Time</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="uptime">0s</div>
                <div class="metric-label">Uptime</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="total-requests">0</div>
                <div class="metric-label">Total Requests</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="success-rate">0%</div>
                <div class="metric-label">Success Rate</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="last-check">Never</div>
                <div class="metric-label">Last Check</div>
            </div>
        </div>
    </div>

    <div class="monitor-section">
        <h3>üéÆ Control Panel</h3>
        <button class="btn-success" onclick="startMonitoring()">Start Live Monitoring</button>
        <button class="btn-danger" onclick="stopMonitoring()">Stop Monitoring</button>
        <button class="btn-primary" onclick="runHealthCheck()">Run Health Check</button>
        <button class="btn-warning" onclick="testClientOperations()">Test Client Operations</button>
        <button class="btn-info" onclick="stressTestAPI()">Stress Test API</button>
        <button class="btn-danger" onclick="clearLogs()">Clear Logs</button>
    </div>

    <div class="test-results">
        <div class="monitor-section">
            <h3>üè• Health Check Results</h3>
            <div id="health-results"></div>
        </div>

        <div class="monitor-section">
            <h3>üë• Client Operations Test</h3>
            <div id="client-results"></div>
        </div>

        <div class="monitor-section">
            <h3>‚ö° Performance Metrics</h3>
            <div id="performance-results"></div>
        </div>

        <div class="monitor-section">
            <h3>üö® Error Tracking</h3>
            <div id="error-results"></div>
        </div>
    </div>

    <div class="monitor-section">
        <h3>üìä Live Test Progress</h3>
        <div class="progress-bar">
            <div class="progress-fill" id="test-progress" style="width: 0%"></div>
        </div>
        <div id="test-status">Ready to start monitoring...</div>
    </div>

    <div class="monitor-section">
        <h3>üìù Live Activity Log</h3>
        <div class="log-container" id="activity-log">
            <div class="log-entry log-info">[SYSTEM] Live monitoring system initialized</div>
        </div>
    </div>

    <script>
        const RAILWAY_URL = 'https://abco-erp-2-production.up.railway.app';
        let monitoringActive = false;
        let monitoringInterval = null;
        let testInterval = null;
        let startTime = null;
        let requestCount = 0;
        let successCount = 0;
        let totalResponseTime = 0;
        let errors = [];
        
        // Live logging system
        function logActivity(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            const logContainer = document.getElementById('activity-log');
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // Keep only last 100 entries
            while (logContainer.children.length > 100) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }
        
        function updateMetrics() {
            document.getElementById('total-requests').textContent = requestCount;
            document.getElementById('success-rate').textContent = 
                requestCount > 0 ? `${Math.round((successCount / requestCount) * 100)}%` : '0%';
            
            if (startTime) {
                const uptime = Math.floor((Date.now() - startTime) / 1000);
                document.getElementById('uptime').textContent = `${uptime}s`;
            }
            
            document.getElementById('last-check').textContent = new Date().toLocaleTimeString();
        }
        
        async function makeRequest(url, options = {}) {
            const startTime = performance.now();
            requestCount++;
            
            try {
                const response = await fetch(url, {
                    ...options,
                    timeout: 10000
                });
                
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                totalResponseTime += responseTime;
                
                document.getElementById('response-time').textContent = `${Math.round(responseTime)}ms`;
                
                if (response.ok) {
                    successCount++;
                    return { success: true, data: await response.json(), responseTime };
                } else {
                    errors.push({
                        timestamp: new Date().toISOString(),
                        url,
                        status: response.status,
                        statusText: response.statusText
                    });
                    return { success: false, error: `HTTP ${response.status}: ${response.statusText}`, responseTime };
                }
            } catch (error) {
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                
                errors.push({
                    timestamp: new Date().toISOString(),
                    url,
                    error: error.message
                });
                
                return { success: false, error: error.message, responseTime };
            }
        }
        
        async function runHealthCheck() {
            logActivity('Running health check...', 'info');
            
            try {
                const result = await makeRequest(`${RAILWAY_URL}/api/health`);
                
                if (result.success) {
                    document.getElementById('deployment-status').textContent = '‚úÖ';
                    document.getElementById('health-results').innerHTML = `
                        <div class="alert alert-success">
                            <h4>‚úÖ Health Check PASSED</h4>
                            <p><strong>Status:</strong> ${result.data.status}</p>
                            <p><strong>Platform:</strong> ${result.data.platform}</p>
                            <p><strong>Version:</strong> ${result.data.version}</p>
                            <p><strong>Response Time:</strong> ${Math.round(result.responseTime)}ms</p>
                        </div>
                    `;
                    logActivity('Health check passed', 'success');
                } else {
                    document.getElementById('deployment-status').textContent = '‚ùå';
                    document.getElementById('health-results').innerHTML = `
                        <div class —Ç–æ–º="alert alert-error">
                            <h4>‚ùå Health Check FAILED</h4>
                            <p><strong>Error:</strong> ${result.error}</p>
                        </div>
                    `;
                    logActivity(`Health check failed: ${result.error}`, 'error');
                }
                
            } catch (error) {
                document.getElementById('deployment-status').textContent = '‚ùå';
                document.getElementById('health-results').innerHTML = `
                    <div class="alert alert-error">
                        <h4>‚ùå Health Check ERROR</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
                logActivity(`Health check error: ${error.message}`, 'error');
            }
        }
        
        async function testClientOperations() {
            logActivity('Testing client operations...', 'info');
            
            try {
                // Test 1: List clients
                const listResult = await makeRequest(`${RAILWAY_URL}/api/clients`);
                
                // Test 2: Create client
                const createResult = await makeRequest(`${RAILWAY_URL}/api/clients`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: `Test Client ${Date.now()}`,
                        email: 'test@example.com',
                        industry: 'Technology'
                    })
                });
                
                // Test 3: Get specific client (if created successfully)
                let getResult = null;
                if (createResult.success && createResult.data.id) {
                    getResult = await makeRequest(`${RAILWAY_URL}/api/clients/${createResult.data.id}`);
                }
                
                const results = [];
                if (listResult.success) {
                    results.push('‚úÖ List clients: PASSED');
                } else {
                    results.push(`‚ùå List clients: ${listResult.error}`);
                }
                
                if (createResult.success) {
                    results.push('‚úÖ Create client: PASSED');
                } else {
                    results.push(`‚ùå Create client: ${createResult.error}`);
                }
                
                if (getResult) {
                    if (getResult.success) {
                        results.push('‚úÖ Get client: PASSED');
                    } else {
                        results.push(`‚ùå Get client: ${getResult.error}`);
                    }
                }
                
                document.getElementById('client-results').innerHTML = `
                    <div class="alert alert-success">
                        <h4>üë• Client Operations Test</h4>
                        <ul>
                            ${results.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    </div>
                `;
                
                logActivity('Client operations test completed', 'success');
                
            } catch (error) {
                document.getElementById('client-results').innerHTML = `
                    <div class="alert alert-error">
                        <h4>‚ùå Client Operations Test ERROR</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
                logActivity(`Client operations test error: ${error.message}`, 'error');
            }
        }
        
        async function stressTestAPI() {
            logActivity('Starting API stress test...', 'warning');
            
            const stressRequests = 20;
            let completed = 0;
            let stressSuccess = 0;
            let stressErrors = 0;
            
            document.getElementById('test-status').textContent = 'Running API stress test...';
            
            for (let i = 0; i < stressRequests; i++) {
                const result = await makeRequest(`${RAILWAY_URL}/api/health`);
                
                if (result.success) {
                    stressSuccess++;
                } else {
                    stressErrors++;
                }
                
                completed++;
                const progress = (completed / stressRequests) * 100;
                document.getElementById('test-progress').style.width = `${progress}%`;
                
                logActivity(`Stress test: ${completed}/${stressRequests} completed`, 'info');
                
                // Small delay between requests
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            const avgResponseTime = totalResponseTime / requestCount;
            
            document.getElementById('performance-results').innerHTML = `
                <div class="alert alert-success">
                    <h4>‚ö° Performance Test Results</h4>
                    <p><strong>Total Requests:</strong> ${stressRequests}</p>
                    <p><strong>Successful:</strong> ${stressSuccess}</p>
                    <p><strong>Failed:</strong> ${stressErrors}</p>
                    <p><strong>Success Rate:</strong> ${Math.round((stressSuccess / stressRequests) * 100)}%</p>
                    <p><strong>Average Response Time:</strong> ${Math.round(avgResponseTime)}ms</p>
                </div>
            `;
            
            document.getElementById('test-progress').style.width = '0%';
            document.getElementById('test-status').textContent = 'Stress test completed';
            
            logActivity(`Stress test completed: ${stressSuccess}/${stressRequests} successful`, 'success');
        }
        
        function startMonitoring() {
            if (monitoringActive) return;
            
            monitoringActive = true;
            startTime = Date.now();
            logActivity('Live monitoring started', 'success');
            
            // Run health check immediately
            runHealthCheck();
            
            // Set up monitoring interval
            monitoringInterval = setInterval(async () => {
                if (monitoringActive) {
                    await runHealthCheck();
                    updateMetrics();
                    updateErrorDisplay();
                }
            }, 30000); // Check every 30 seconds
            
            // Set up continuous testing
            testInterval = setInterval(async () => {
                if (monitoringActive) {
                    await testClientOperations();
                }
            }, 60000); // Test client operations every minute
            
            document.getElementById('test-status').textContent = 'Live monitoring active';
        }
        
        function stopMonitoring() {
            monitoringActive = false;
            
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }
            
            if (testInterval) {
                clearInterval(testInterval);
                testInterval = null;
            }
            
            logActivity('Live monitoring stopped', 'warning');
            document.getElementById('test-status').textContent = 'Monitoring stopped';
        }
        
        function updateErrorDisplay() {
            const recentErrors = errors.slice(-10);
            
            if (recentErrors.length > 0) {
                document.getElementById('error-results').innerHTML = `
                    <div class="alert alert-warning">
                        <h4>üö® Recent Errors (${recentErrors.length})</h4>
                        <ul>
                            ${recentErrors.map(error => `
                                <li>
                                    <strong>${new Date(error.timestamp).toLocaleTimeString()}</strong>
                                    ${error.url ? error.url : ''}
                                    ${error.error ? `- ${error.error}` : ''}
                                    ${error.status ? `- HTTP ${error.status}` : ''}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            } else {
                document.getElementById('error-results').innerHTML = `
                    <div class="alert alert-success">
                        <h4>‚úÖ No Recent Errors</h4>
                        <p>System is running smoothly!</p>
                    </div>
                `;
            }
        }
        
        function clearLogs() {
            document.getElementById('activity-log').innerHTML = '';
            errors = [];
            requestCount = 0;
            successCount = 0;
            totalResponseTime = 0;
            updateMetrics();
            logActivity('Logs cleared', 'info');
        }
        
        // Initialize
        window.onload = function() {
            logActivity('Live monitoring system initialized', 'info');
            updateMetrics();
            
            // Auto-start monitoring after 2 seconds
            setTimeout(() => {
                logActivity('Auto-starting monitoring in 3 seconds...', 'info');
                setTimeout(() => {
                    startMonitoring();
                }, 3000);
            }, 2000);
        };
        
        // Cleanup on page unload
        window.onbeforeunload = function() {
            stopMonitoring();
        };
    </script>
</body>
</html>
