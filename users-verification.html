<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users Section Verification - Abcotronics ERP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <div id="root"></div>

    <!-- Load all required components -->
    <script type="text/babel" src="./src/components/users/UserManagement.jsx"></script>
    <script type="text/babel" src="./src/utils/permissions.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Mock storage for testing
        window.storage = {
            getToken: () => 'mock-token-for-testing',
            getUser: () => ({
                id: 'test-admin',
                name: 'Test Admin',
                email: 'admin@test.com',
                role: 'admin'
            }),
            setUser: (user) => console.log('Setting user:', user),
            getUsers: () => [],
            setUsers: (users) => console.log('Setting users:', users)
        };

        // Mock theme hook
        window.useTheme = () => ({ isDark: false });

        // Mock API responses
        const mockApiResponses = {
            '/api/users': {
                users: [
                    {
                        id: 'user-1',
                        name: 'John Doe',
                        email: 'john@example.com',
                        role: 'member',
                        status: 'active',
                        createdAt: '2024-01-15T10:00:00Z',
                        lastLoginAt: '2024-01-20T14:30:00Z'
                    },
                    {
                        id: 'user-2',
                        name: 'Jane Smith',
                        email: 'jane@example.com',
                        role: 'manager',
                        status: 'active',
                        createdAt: '2024-01-10T09:00:00Z',
                        lastLoginAt: '2024-01-21T11:15:00Z'
                    }
                ],
                invitations: [
                    {
                        id: 'inv-1',
                        email: 'newuser@example.com',
                        name: 'New User',
                        role: 'member',
                        status: 'pending',
                        expiresAt: '2024-01-28T10:00:00Z',
                        createdAt: '2024-01-21T10:00:00Z'
                    }
                ]
            }
        };

        // Mock fetch
        const originalFetch = window.fetch;
        window.fetch = async (url, options) => {
            console.log('Mock API call:', url, options);
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 500));
            
            if (url === '/api/users' && options?.method === 'GET') {
                return {
                    ok: true,
                    json: async () => mockApiResponses['/api/users']
                };
            }
            
            if (url === '/api/users' && options?.method === 'POST') {
                return {
                    ok: true,
                    json: async () => ({
                        success: true,
                        message: 'User created successfully',
                        user: {
                            id: 'new-user-' + Date.now(),
                            name: JSON.parse(options.body).name,
                            email: JSON.parse(options.body).email,
                            role: JSON.parse(options.body).role,
                            status: 'active'
                        }
                    })
                };
            }
            
            if (url === '/api/users/invite' && options?.method === 'POST') {
                return {
                    ok: true,
                    json: async () => ({
                        success: true,
                        message: 'Invitation sent successfully',
                        invitation: {
                            id: 'inv-' + Date.now(),
                            email: JSON.parse(options.body).email,
                            name: JSON.parse(options.body).name,
                            role: JSON.parse(options.body).role,
                            status: 'pending',
                            expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
                        }
                    })
                };
            }
            
            return originalFetch(url, options);
        };

        const UsersVerification = () => {
            const [status, setStatus] = useState('loading');
            const [error, setError] = useState(null);

            useEffect(() => {
                // Wait for components to load
                const checkComponents = () => {
                    if (window.UserManagement && window.PERMISSIONS) {
                        setStatus('ready');
                    } else {
                        setTimeout(checkComponents, 100);
                    }
                };
                
                checkComponents();
            }, []);

            if (status === 'loading') {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"></div>
                            <p className="text-white text-lg">Loading User Management...</p>
                        </div>
                    </div>
                );
            }

            if (status === 'error') {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="bg-white rounded-xl shadow-lg p-8 max-w-md mx-auto">
                            <div className="text-center">
                                <i className="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                                <h2 className="text-xl font-bold text-gray-900 mb-2">Error Loading Users</h2>
                                <p className="text-gray-600 mb-4">{error}</p>
                                <button
                                    onClick={() => window.location.reload()}
                                    className="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700"
                                >
                                    Reload Page
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen">
                    <div className="bg-white shadow-lg">
                        <div className="px-6 py-4 border-b border-gray-200">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="text-2xl font-bold text-gray-900">Users Management</h1>
                                    <p className="text-gray-600">Direct verification of User Management component</p>
                                </div>
                                <div className="flex items-center gap-4">
                                    <div className="flex items-center text-green-600">
                                        <i className="fas fa-check-circle mr-2"></i>
                                        <span className="text-sm font-medium">Component Loaded</span>
                                    </div>
                                    <button
                                        onClick={() => window.open('/index.html', '_blank')}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                                    >
                                        <i className="fas fa-external-link-alt mr-2"></i>
                                        Open Main ERP
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div className="p-6">
                            <window.UserManagement />
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<UsersVerification />, document.getElementById('root'));
    </script>
</body>
</html>
